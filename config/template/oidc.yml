    

http:
  middlewares:
    magic-proxy-{{ app_name }}-oidc:
      plugin:
        traefik-oidc-auth:
          Secret: "3141234" 
          Provider:
            Url: "https://auth.stonegray.ca/application/o/traefik/"
            ClientId: "asdlkfjhalsdkjgas"
            ClientSecret: "asdklgjhasd"
          Scopes: "openid email profile"
          CallbackURL: "/oidc/callback"
          CookieSameSite: "lax"
          LogLevel: DEBUG
          Authorization:
            AssertClaims:
              - Name: groups
                Exists: true
              - Name: groups
                AllOf: ["magic-proxy", "magic-proxy-{{ app_name }}"]
    geoblock:
      plugin:
        geoblock:
          allowedCountries:
            - CA
            - US
          bannedCountries:
            - RU
            - CN
          api: "https://get.geojs.io/v1/ip/country.json"

  routers:
    magic-proxy-{{ app_name }}:
      rule: Host(`{{ app_name }}.{{ hostname }}`)
      entryPoints:
        - web
      middlewares:
        - geoblock
      service: magic-proxy-{{ app_name }}

  services:
    magic-proxy-{{ app_name }}:
      loadBalancer:
        servers:
          - url: "{{ target_url }}"